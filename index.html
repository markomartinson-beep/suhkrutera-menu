<!doctype html>
<html lang="et">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Suhkrutera Â· LÃµunapakkumised</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card{border-radius:1rem;border:1px solid rgb(253 230 138);box-shadow:0 1px 8px rgba(0,0,0,.05)}
    .qty{width:4.5rem}
    .badge{border-radius:9999px;background:#f4f4f5;color:#111827;padding:.1rem .4rem;font-size:.75rem}
    .icon{width:20px;height:20px;margin-top:2px}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-amber-50 to-orange-50 text-zinc-900">
  <main id="app" class="max-w-6xl mx-auto px-6 pt-10 pb-10">
    <!-- Hero -->
    <section class="flex flex-col items-center text-center gap-3 mb-6">
      <div class="text-sm font-medium uppercase tracking-widest text-amber-700">LÃµunapakkumised â€¢ ProovinÃ¤dal</div>
      <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Teeme lÃµunal teie kÃµhu rÃµÃµmsaks</h1>
      <p class="text-zinc-600 max-w-2xl">
        Valmistame suure armastusega ja toome soojalt teieni. Meie eesmÃ¤rk on ausad ja kvaliteetsed maitsed.
        KÃµik soolased toidud sisaldavad leiva/saia kuklit; KÃµigil pearoogadel on iga pÃ¤ev lisandina vÃ¤rskendav salat.
        MÃ¤rgistused: <strong>T</strong> â€” taimne, <strong>V</strong> â€” vegan, <strong>GV</strong> â€” gluteenivaba, <strong>LV</strong> â€” laktoosivaba.
      </p>
    </section>

    <!-- Menu grid -->
    <section id="menu" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8"></section>

    <!-- Checkout -->
    <section class="max-w-3xl mx-auto">
      <form id="orderForm" class="rounded-2xl border border-amber-200 bg-white/70 p-5 shadow-sm">
        <h2 class="text-xl font-bold mb-3 flex items-center gap-2">âœ… Kliendi andmed ja kinnitamine</h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
          <input id="name" placeholder="Nimi *" required class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
          <input id="phone" placeholder="Telefon *" required class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
          <input id="email" type="email" placeholder="E-post *" required class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
          <input id="pickup" placeholder="KÃ¤ttesaamise aeg (nt 12:30)" class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
          <input id="company" placeholder="EttevÃµtte nimi *" required class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
          <input id="address" placeholder="Aadress *" required class="rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
        </div>

        <textarea id="notes" placeholder="MÃ¤rkused (nt erisoovid)" class="mt-3 w-full rounded-lg border border-amber-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" rows="3"></textarea>

        <div id="err" class="hidden mt-3 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700"></div>
        <div id="ok" class="hidden mt-3 rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700">Tellimus vastu vÃµetud! ðŸ™Œ</div>

        <div class="mt-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-3">
          <div class="text-sm text-zinc-700">
            <div>Kokku (sh komplektid): <strong id="grand">â‚¬0.00</strong></div>
            <div class="text-zinc-500 text-xs">Komplekt = supp + praad (liha vÃµi taimne) + magustoit @ â‚¬14.00.</div>
          </div>
          <button id="submitBtn" type="submit" class="inline-flex items-center justify-center rounded-xl border border-amber-300 bg-amber-500/90 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-amber-500 disabled:opacity-60 focus:outline-none focus:ring-2 focus:ring-amber-300">
            Kinnita ja saada
          </button>
        </div>

        <p class="mt-2 text-xs text-zinc-500">PÃ¤rast saatmist kuvatakse kinnitus siin samal lehel.</p>
      </form>
    </section>
  </main>

  <script>
  // ---------- KONFIG ----------
  const GETFORM_ENDPOINT = "https://getform.io/f/avrmjgxa";
  const PRICE = { soup: 4.5, mainMeat: 7.5, mainVeg: 7.0, dessert: 4.0, salad: 6.5, combo: 14.0 };
  const days = [
    { name:"EsmaspÃ¤ev", soup:"Pikantne tomatisupp suitsujuustuga", main:"BBQ rebitud liha rosmariinikartuliga", veg:"Kreemine seenepasta Ã¼rtide ja parmesaniga", vegTags:["T"], dessert:"Eestimaine Ãµuna-kohupiima kook" },
    { name:"TeisipÃ¤ev", soup:"MetsahÃµnguline seenesupp", main:"Ãœrdi-sidruni kastmes lÃµhe kÃ¶Ã¶giviljariisiga", veg:"Bataadi-kikerherne karri jasmiiniriisiga", vegTags:["V","GV"], dessert:"Mooni-Å¡okolaadi saiake", dessertTags:["T","GV"] },
    { name:"KolmapÃ¤ev", soup:"Autentne Tom Kha kanaga", main:"Rohumaaveise lasanje", veg:"KÃ¶Ã¶giviljanuudlid seesami ja koriandriga", vegTags:["V"], dessert:"Pavlova passionikreemi ja vÃ¤rskete marjadega", dessertTags:["T"] },
    { name:"NeljapÃ¤ev", soup:"Frikadellisupp", main:"Burgundia pada rÃ¶stitud juurviljadega", veg:"KÃ¶Ã¶givilja lasanje tomatatises ricotta kastmes", vegTags:["T"], dessert:"Sidrunitort", dessertTags:["T"] },
    { name:"Reede", soup:"Kosutav kÃµrvitsapÃ¼reesupp balsamicoga", main:"KrÃµbekana steakhouse friikartulite ja Ã¼rdimajoneesiga", mainTags:["GV","LV"], veg:"Pasta Alfredo spinati ja pÃ¤ikesekuivatatud tomatitega", vegTags:["T"], dessert:"Pidulik kaneelisai" }
  ];
  const dailyExtras = [{ label:"Avokaado salat halloumi juustu ja granaatÃµunaga", day:"Reede", key:"extra_salat" }];

  // ---------- ABID ----------
  const eur = n => new Intl.NumberFormat("et-EE",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(n);
  const qty = {}; // "PÃ¤ev|Rida" -> number

  function computePrice(qty) {
    const byDay = {};
    days.forEach(d=>{
      const keyCombo = `${d.name}|Komplekt`;
      const keySoup  = `${d.name}|Supp`;
      const keyMeat  = `${d.name}|Pearoog`;
      const keyVeg   = `${d.name}|Taimne`;
      const keyDess  = `${d.name}|Magustoit`;
      const combo = Math.max(0, qty[keyCombo]||0);
      const leftovers = {
        soup: Math.max(0, qty[keySoup]||0),
        meat: Math.max(0, qty[keyMeat]||0),
        veg:  Math.max(0, qty[keyVeg]||0),
        dessert: Math.max(0, qty[keyDess]||0),
      };
      const sum = combo*PRICE.combo + leftovers.soup*PRICE.soup + leftovers.meat*PRICE.mainMeat + leftovers.veg*PRICE.mainVeg + leftovers.dessert*PRICE.dessert;
      byDay[d.name] = { combo, leftovers, sum };
    });
    const saladKey = `Reede|Lisaks: ${dailyExtras[0].label}`;
    const saladQ = qty[saladKey]||0;
    const dayTotals = Object.values(byDay).reduce((a,v)=>a+v.sum,0);
    const grand = dayTotals + saladQ*PRICE.salad;
    return { byDay, saladQ, dayTotals, grand };
  }

  function renderMenu(){
    const root = document.getElementById("menu");
    root.innerHTML = "";
    days.forEach(d=>{
      const card = document.createElement("div");
      card.className = "card bg-white/80 p-4";
      const header = `
        <div class="pb-2 border-b border-amber-100 mb-3 flex items-center justify-between">
          <span class="text-xl font-bold">${d.name}</span>
          <span class="text-amber-700/90 text-sm font-medium">LÃµunamenÃ¼Ã¼</span>
        </div>`;
      const base = [
        { label:"Supp",       val:d.soup,    price:PRICE.soup },
        { label:"Pearoog",    val:d.main,    price:PRICE.mainMeat, tags:d.mainTags },
        { label:"Taimne",     val:d.veg,     price:PRICE.mainVeg,  tags:d.vegTags },
        { label:"Magustoit",  val:d.dessert, price:PRICE.dessert,  tags:d.dessertTags },
      ];
      const rows = [...base];
      if (d.name==="Reede"){
        rows.push({ label:"Salat", val:dailyExtras[0].label, price:PRICE.salad, extraKey:`Reede|Lisaks: ${dailyExtras[0].label}` });
      }
      rows.push({ label:"Komplekt", val:"Supp + praad (liha vÃµi taimne) + magustoit", price:PRICE.combo });

      const lines = rows.map(row=>{
        const key = row.extraKey ? row.extraKey : `${d.name}|${row.label}`;
        const tags = (row.tags||[]).map(t=>`<span class="badge">${t}</span>`).join(" ");
        const value = qty[key] ?? 0;
        return `
          <div class="flex items-start gap-3 mb-3">
            <div class="flex-1">
              <div class="font-semibold flex items-center gap-2">
                ${row.label}
                <div class="flex gap-1">${tags}</div>
                <span class="ml-auto text-sm font-normal text-amber-700">${eur(row.price)}</span>
              </div>
              <div class="text-sm text-zinc-700">${row.val}</div>
            </div>
            <div class="shrink-0 flex items-center gap-2">
              <label class="text-xs text-zinc-600" for="qty_${key}">tk</label>
              <input id="qty_${key}" type="number" min="0" max="999" value="${value}" class="qty rounded-lg border border-amber-200 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-amber-300" />
            </div>
          </div>`;
      }).join("");

      const dSum = computePrice(qty).byDay[d.name];
      const parts = [];
      if (dSum?.combo) parts.push(`Komplektid Ã— ${dSum.combo}`);
      if (dSum?.leftovers?.soup) parts.push(`Supp Ã— ${dSum.leftovers.soup}`);
      if (dSum?.leftovers?.meat) parts.push(`Lihaga praad Ã— ${dSum.leftovers.meat}`);
      if (dSum?.leftovers?.veg)  parts.push(`Lihata praad Ã— ${dSum.leftovers.veg}`);
      if (dSum?.leftovers?.dessert) parts.push(`Magustoit Ã— ${dSum.leftovers.dessert}`);

      const footer = `
        <div class="mt-3 rounded-lg border border-amber-100 bg-amber-50/60 px-3 py-2 text-sm text-amber-900 flex items-center justify-between">
          <span>${parts.length ? parts.join(" Â· ") : "Pole valikuid"}</span>
          <strong>${eur(dSum?.sum || 0)}</strong>
        </div>`;

      card.innerHTML = header + lines + footer;
      root.appendChild(card);
    });

    // lisame kuulajad
    root.querySelectorAll("input[id^='qty_']").forEach(inp=>{
      inp.addEventListener("input", (e)=>{
        const id = e.target.id.substring(4);
        let v = parseInt(e.target.value||"0",10);
        if (isNaN(v) || v<0) v=0;
        qty[id]=v;
        updateTotals();
        renderMenu(); // vÃ¤rskenda pÃ¤evakokkuvÃµtteid
      });
    });
  }

  function updateTotals(){
    const { grand } = computePrice(qty);
    document.getElementById("grand").textContent = eur(grand);
  }

  // Submit
  document.getElementById("orderForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const err = document.getElementById("err");
    const ok  = document.getElementById("ok");
    err.classList.add("hidden");
    ok.classList.add("hidden");

    // valideeri vÃ¤hemalt Ã¼ks kogus
    const hasQty = Object.values(qty).some(n => (n||0) > 0);
    if (!hasQty){ err.textContent = "Palun vali vÃ¤hemalt Ã¼ks kogus."; err.classList.remove("hidden"); return; }

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const email = document.getElementById("email").value.trim();
    const pickup = document.getElementById("pickup").value.trim();
    const company = document.getElementById("company").value.trim();
    const address = document.getElementById("address").value.trim();
    const notes = document.getElementById("notes").value.trim();

    // kokkuvÃµte
    const pb = computePrice(qty);
    const lines = [];
    Object.keys(pb.byDay).forEach(day=>{
      const d = pb.byDay[day];
      if (d.combo || d.leftovers.soup || d.leftovers.meat || d.leftovers.veg || d.leftovers.dessert){
        lines.push(`${day}:`);
        if (d.combo) lines.push(`  â€¢ Komplektid Ã— ${d.combo} @ ${eur(PRICE.combo)}`);
        if (d.leftovers.soup) lines.push(`  â€¢ Supp Ã— ${d.leftovers.soup} @ ${eur(PRICE.soup)}`);
        if (d.leftovers.meat) lines.push(`  â€¢ Lihaga praad Ã— ${d.leftovers.meat} @ ${eur(PRICE.mainMeat)}`);
        if (d.leftovers.veg)  lines.push(`  â€¢ Lihata praad Ã— ${d.leftovers.veg} @ ${eur(PRICE.mainVeg)}`);
        if (d.leftovers.dessert) lines.push(`  â€¢ Magustoit Ã— ${d.leftovers.dessert} @ ${eur(PRICE.dessert)}`);
        lines.push(`  = ${eur(d.sum)}`);
      }
    });
    if (pb.saladQ){
      lines.push(`Reede lisaks: Salat Ã— ${pb.saladQ} @ ${eur(PRICE.salad)} = ${eur(pb.saladQ*PRICE.salad)}`);
    }
    const summary = lines.join("\n");

    // saadame
    try{
      document.getElementById("submitBtn").disabled = true;
      const fd = new FormData();
      fd.append("recipient","info@suhkrutera.ee");
      fd.append("subject","LÃµunatellimus â€“ Suhkrutera");
      fd.append("customer_name",name);
      fd.append("customer_phone",phone);
      fd.append("customer_email",email);
      fd.append("company_name",company);
      fd.append("company_address",address);
      fd.append("pickup_time",pickup);
      fd.append("notes",notes);
      fd.append("order_summary",summary);
      fd.append("order_total_eur", String(pb.grand.toFixed(2)));
      Object.entries(qty).forEach(([k,n])=>{ if((n||0)>0) fd.append(k.replaceAll(" ","_").toLowerCase(), String(n)); });

      const resp = await fetch(GETFORM_ENDPOINT,{ method:"POST", body:fd });
      if(!resp.ok) throw new Error("Viga: "+resp.status);
      ok.classList.remove("hidden");
      // reset
      Object.keys(qty).forEach(k=>qty[k]=0);
      document.querySelectorAll("input[id^='qty_']").forEach(i=>i.value=0);
      updateTotals();
    }catch(e){
      err.textContent = "Saatmine ebaÃµnnestus. Kontrolli netti vÃµi proovi uuesti.";
      err.classList.remove("hidden");
    }finally{
      document.getElementById("submitBtn").disabled = false;
    }
  });

  // init
  renderMenu();
  updateTotals();
  </script>
</body>
</html>
